machine:
  java:
    version: openjdk8
    
dependencies: 
  override:
    - echo 'Skipping Dependency Check'

test:
  override:
    - mvn clean verify
    
  post:
    - mv org.nasdanika.config.repository/target/repository $CIRCLE_ARTIFACTS    
    - mv org.nasdanika.config.repository/target/org.nasdanika.config.repository-*.zip $CIRCLE_ARTIFACTS    

    - mvn clean verify javadoc:javadoc
    
    - mkdir $CIRCLE_ARTIFACTS/apidocs
    
    - mkdir $CIRCLE_ARTIFACTS/apidocs/org.nasdanika.config.editor
    - mkdir $CIRCLE_ARTIFACTS/apidocs/org.nasdanika.config.edit
    - mkdir $CIRCLE_ARTIFACTS/apidocs/org.nasdanika.config
    
    - mv org.nasdanika.config.editor/target/site/apidocs $CIRCLE_ARTIFACTS/apidocs/org.nasdanika.config.editor
    - mv org.nasdanika.config.edit/target/site/apidocs $CIRCLE_ARTIFACTS/apidocs/org.nasdanika.config.edit
    - mv org.nasdanika.config/target/site/apidocs $CIRCLE_ARTIFACTS/apidocs/org.nasdanika.config    
    
deployment:
  staging:
    branch: master
    commands:      
    - wget http://nasdanika.org/commons-net-1.4.1.jar
    - wget http://nasdanika.org/jakarta-oro-2.0.8.jar    
    - ant -verbose -f ftp-upload.xml -lib commons-net-1.4.1.jar:jakarta-oro-2.0.8.jar -Dftp.server=$DEPLOY_FTP_SERVER -Dftp.user=$DEPLOY_FTP_USER -Dftp.password=$DEPLOY_FTP_PASSWORD -Dcircle.artifacts=$CIRCLE_ARTIFACTS
    - curl --header "Content-Type: application/json" --request POST https://circleci.com/api/v1/project/Nasdanika/codegen/tree/master?circle-token=$CODEGEN_TOKEN
